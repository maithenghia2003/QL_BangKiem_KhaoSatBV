@model QL_BangKiem_KhaoSat.Models.XacDinhBangKiem

<h1 style="text-align: center;">BẢNG KIỂM 3 ĐÚNG KHI THỰC HIỆN THỦ THUẬT/ PHẪU THUẬT</h1>

@using (Html.BeginForm("LuuKetQua", "ThuThuatPhauThuat", FormMethod.Post))
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th rowspan="2" style="vertical-align: middle;">STT</th>
                <th rowspan="2" style="vertical-align: middle;">NỘI DUNG ĐÁNH GIÁ</th>
                <th colspan="3" class="text-center">NVYT Thực hiện</th>
                <th colspan="3" class="text-center">NVYT Thực hiện</th>
            </tr>
            <tr>
                <th class="text-center">Thực hiện đầy đủ (1đ)</th>
                <th class="text-center">Thực hiện chưa đạt (0.5đ)</th>
                <th class="text-center">Không thực hiện (0đ)</th>
                <th class="text-center">Thực hiện đầy đủ (1đ)</th>
                <th class="text-center">Thực hiện chưa đạt (0.5đ)</th>
                <th class="text-center">Không thực hiện (0đ)</th>
            </tr>
            <tr>
                <th colspan="2" class="text-right">Tên NVYT:</th>
                <th colspan="3"><input type="text" asp-for="TenNVYT1" class="form-control" placeholder="Ghi tên NVYT 1" /></th>
                <th colspan="3"><input type="text" asp-for="TenNVYT2" class="form-control" placeholder="Ghi tên NVYT 2" /></th>
            </tr>
        </thead>
        <tbody>
            @{
                int currentSTT = 0;
            }
            @for (var i = 0; i < Model.CacYeuTo.Count; i++)
            {
                var item = Model.CacYeuTo[i];
                <tr>
                    @if (item.STT != 0) // Chỉ hiển thị STT cho các mục chính
                    {
                        currentSTT = item.STT;
                        <td rowspan="@(item.STT == 1 ? "6" : "1")" style="vertical-align: middle;">@item.STT</td> @* STT 1 có 5 mục con + chính nó = 6 hàng *@
                    }
                    else
                    {
                        // Ẩn cột STT cho các mục con
                        <td style="display:none;"></td>
                    }

                    <td>@item.NoiDung</td>

                    @if (item.STT == 1) // Hàng "Đúng người bệnh"
                    {
                        <td colspan="3" class="text-center">
                            <input type="radio" name="CacYeuTo[@i].KetQuaNVYT1" value="Dat" asp-for="CacYeuTo[i].KetQuaNVYT1" /> Đạt <br />
                            <input type="radio" name="CacYeuTo[@i].KetQuaNVYT1" value="KhongDat" asp-for="CacYeuTo[i].KetQuaNVYT1" /> Không đạt <br />
                            <input type="radio" name="CacYeuTo[@i].KetQuaNVYT1" value="ChuaDat" asp-for="CacYeuTo[i].KetQuaNVYT1" /> Chưa đạt
                        </td>
                        <td colspan="3" class="text-center">
                            <input type="radio" name="CacYeuTo[@i].KetQuaNVYT2" value="Dat" asp-for="CacYeuTo[i].KetQuaNVYT2" /> Đạt <br />
                            <input type="radio" name="CacYeuTo[@i].KetQuaNVYT2" value="KhongDat" asp-for="CacYeuTo[i].KetQuaNVYT2" /> Không đạt <br />
                            <input type="radio" name="CacYeuTo[@i].KetQuaNVYT2" value="ChuaDat" asp-for="CacYeuTo[i].KetQuaNVYT2" /> Chưa đạt
                        </td>
                    }
                    else if (item.STT == 0) // Các mục con của "Đúng người bệnh"
                    {
                        <td class="text-center"><input type="checkbox" /></td>
                        <td class="text-center"><input type="checkbox" /></td>
                        <td class="text-center"><input type="checkbox" /></td>
                        <td class="text-center"><input type="checkbox" /></td>
                        <td class="text-center"><input type="checkbox" /></td>
                        <td class="text-center"><input type="checkbox" /></td>
                    }
                    else // Các mục còn lại ("Đúng vị trí", "Đúng phương pháp")
                    {
                        <td class="text-center"><input type="radio" name="CacYeuTo[@i].KetQuaNVYT1" value="Dat" asp-for="CacYeuTo[i].KetQuaNVYT1" /></td>
                        <td class="text-center"><input type="radio" name="CacYeuTo[@i].KetQuaNVYT1" value="ChuaDat" asp-for="CacYeuTo[i].KetQuaNVYT1" /></td>
                        <td class="text-center"><input type="radio" name="CacYeuTo[@i].KetQuaNVYT1" value="KhongThucHien" asp-for="CacYeuTo[i].KetQuaNVYT1" /></td>
                        <td class="text-center"><input type="radio" name="CacYeuTo[@i].KetQuaNVYT2" value="Dat" asp-for="CacYeuTo[i].KetQuaNVYT2" /></td>
                        <td class="text-center"><input type="radio" name="CacYeuTo[@i].KetQuaNVYT2" value="ChuaDat" asp-for="CacYeuTo[i].KetQuaNVYT2" /></td>
                        <td class="text-center"><input type="radio" name="CacYeuTo[@i].KetQuaNVYT2" value="KhongThucHien" asp-for="CacYeuTo[i].KetQuaNVYT2" /></td>
                    }
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td></td>
                <td><strong>Kết luận Đúng người bệnh</strong></td>
                <td colspan="3" class="text-center">
                    <input type="radio" asp-for="KetLuanDungNguoiBenhNVYT1" value="Dat" /> Đạt <br />
                    <input type="radio" asp-for="KetLuanDungNguoiBenhNVYT1" value="ChuaDat" /> Chưa đạt <br />
                    <input type="radio" asp-for="KetLuanDungNguoiBenhNVYT1" value="KhongDat" /> Không đạt
                </td>
                <td colspan="3" class="text-center">
                    <input type="radio" asp-for="KetLuanDungNguoiBenhNVYT2" value="Dat" /> Đạt <br />
                    <input type="radio" asp-for="KetLuanDungNguoiBenhNVYT2" value="ChuaDat" /> Chưa đạt <br />
                    <input type="radio" asp-for="KetLuanDungNguoiBenhNVYT2" value="KhongDat" /> Không đạt
                </td>
            </tr>
        </tfoot>
    </table>

    <br />

    <div>
        <strong>Lưu ý:</strong>
        <ul>
            <li>
                Một số ghi chú:
                <ul>
                    <li>NVYT sử dụng câu hỏi mở (với thông tin: họ tên, năm sinh/ tuổi, địa chỉ) và kiểm tra tra lại sau khi NB/ thân nhân trả lời;</li>
                    <li>Yếu tố giới tính không áp dụng tại: Phòng khám tuyến vú, phụ khoa; Khoa Ngoại tuyến vú, Ngoại phụ khoa, Xạ trị phụ khoa;</li>
                    <li>Yếu tố địa chỉ: Phải đầy đủ 3 cấp thông tin cư trú (xã/phường/thị trấn, quận/huyện/thành phố/tỉnh);</li>
                </ul>
            </li>
            <li>
                Sau khi đánh giá chi tiết từng yếu tố đánh kèm của mục 1 (đúng người bệnh) → tiến hành kết luận nội dung “đúng người bệnh” như sau:
                <ol>
                    <li>“Đạt”: khi ít nhất 3 yếu tố được đánh giá ở cột “thực hiện đầy đủ - 1đ”;</li>
                    <li>“Chưa đạt”: khi đánh giá ít hơn 3 yếu tố; hoặc khi đánh giá từ 3 yếu tố trở lên nhưng chỉ có 2 yếu tố ở cột “thực hiện đầy đủ - 1đ”;</li>
                    <li>“Không đạt”: khi tiếp xúc người bệnh mà không xác nhận lại thông tin của người bệnh;</li>
                </ol>
            </li>
            <li>Các nội dung còn lại đánh giá theo thang điểm có sẵn</li>
        </ul>
    </div>

    <button type="submit" class="btn btn-primary">Lưu Kết Quả</button>
}
